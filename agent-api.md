API пополнения кошельков synq.ru
=========

Выполнение запроса
---------
URL всех запросов API начинаются с префикса `https://www.synq.ru/protocol/agent/v1/`. **Мы поддерживаем только HTTPS.**
Для того, чтобы выполнить команду протокола нужно склеить префикс с именем команды, например, для команды balance URL будет `https://www.synq.ru/protocol/agent/v1/balance`.
Если вы используете утилиту curl, то команду balance можно вызвать следующим образом
```shell
curl -u user:pass https://www.synq.ru/protocol/agent/v1/balance
```

Аутентификация
---------

Мы используем стандартную Basic аутентификацию протокола HTTP. Это безопасно, поскольку мы работаем по протоколу HTTPS.

Команды API
---------

### Запрос баланса агента
* `GET /protocol/agent/v1/balance` вернет баланс счета агента в копейках.

```xml
<response>
    <balance>100500</balance>
<response>
```

### Проверка возможности пополнения кошелька
* `GET /protocol/agent/v1/check?account=999&sum=100500` вернет результат проверки возможности пополнения кошелька 999 на сумму 100500 копеек.

```xml
<response>
    <result>0</result>
    <comment>OK</comment>
<response>
```
Возвращение ответа **0 OK** в ответ на команду check означает, что кошелек существует, не заблокирован и может быть
пополнен на указанную в параметрах сумму.

### Пополнение кошелька
* `POST /protocol/agent/v1/pay` с параметрами

```
txn_id=999999999999&account=999&sum=100500
```
пополнит кошелек 999 на сумму 100500 копеек.

```xml
<response>
    <prv_txn>132456</prv_txn>
    <sum>100500</sum>
    <result>60</result>
    <comment>В процессе проведения, запросите статус позже.</comment>
<response>
```

Параметр txn_id - идентификатор платежа на стороне клиента,
служит для предотвращения дублирования платежей в случае проблем со связью. Если платеж с таким txn_id уже
зарегистрирован в synq.ru, то вместо пополнения кошелька мы вернем статус платежа с таким txn_id.

```xml
<response>
    <prv_txn>132456</prv_txn>
    <sum>100500</sum>
    <result>50</result>
    <comment>Успешно проведен.</comment>
<response>
```

### Коды ошибок
*         0              OK.
*         1              Не передан обязательный параметр ****.
*         2              Кошелек с ID **** не существует.
*         3              Недостаточно средств на счете агента.
*         42             Внутренняя ошибка системы.
*         50             Успешно проведен.
*         51             Не проведен.
*         60             В процессе проведения, запросите статус позже.

Обработка ошибок HTTP протокола
---------
В случае получения от synq.ru HTTP статусов 5xx, например `502 Bad Gateway`, `503 Service Unavailable`, или
`504 Gateway Timeout` повторите запрос позже.
