API мобильных устройств synq.ru
=========

Выполнение запроса
---------
URL всех запросов API начинаются с префикса `https://www.synq.ru/protocol/mobile/v1/`. **Мы поддерживаем только HTTPS.**
Для того, чтобы выполнить команду протокола нужно склеить префикс с именем команды, например, для команды providers URL будет `https://www.synq.ru/protocol/mobile/v1/providers`.
Для представления запросов и ответов используется формат JSON.
Если вы используете утилиту curl, то команду providers можно вызвать следующим образом
```shell
curl -u user:pass https://www.synq.ru/protocol/mobile/v1/providers
```

Аутентификация
---------

Мы используем стандартную Basic аутентификацию протокола HTTP. Это безопасно, поскольку мы работаем по протоколу HTTPS.
Все команды протокола, кроме `register`и `confirm`, требуют аутентификации. В качестве логина можно передавать 
номер телефона, email или номер любого из счетов кошелька.

Команды API
---------

### Проверка правильности учетных данных
* `POST /protocol/mobile/v1/auth`
с телом

```json
{"applicationId": "my cool app"}
```
вернет статус `200` в случае, если переданные учетные данные верны. В противном случает будет `401`.

### Регистрация пользователя
* `POST /protocol/mobile/v1/register`

```json
{"phone": "9267101280", "email": "someone@example.com", "password": "p@$$w0rd"}
```
вернет
```json
{"userId": 13}
```
если пользователь успешно создан.
В случае, если пользователь с таким email или phone уже существует, в ответе будет

```json
{"exist": ["email", "phoneNumber"]}
```

После успешной регистрации требуется подтвердить используемый номер телефона с помощью команды `confirm`.

### Подтвержение телефона пользователя
* `POST /protocol/mobile/v1/confirm`
с телом

```json
{"phone": "9267101280", "pin": "123456"}
```
подтвердит номер телефона пользователя и вернет статус активации.

```json
{"activated": true}
```


### Загрузка справочника провайдеров

* `GET /protocol/mobile/v1/providers`

вернет справочник провайдеров с разбиением по группам

```json
[ {
  "id" : 5,
  "name" : "Мобильная связь СНГ",
  "providers" : [ {
    "id" : 710881731,
    "name" : "MegaCom(АльфаТелеком) Кыргызстан (7)"
  }, {
    "id" : 518042683,
    "name" : "Билайн-Армения(АрменТел) (7)"
  } ]
}, {
  "id" : 6,
  "name" : "Мобильная связь",
  "providers" : [ {
    "id" : 750739964,
    "name" : "Tele2 без комиссии"
  }, {
    "id" : 890983449,
    "name" : "Билайн без комиссии"
  }]
}]
```

### Загрузка описания провайдера

* `GET /protocol/mobile/v1/providers/${providerId}`

вернет описание провайдера, например:

```json
{
  "id" : 890983449,
  "name" : "Билайн без комиссии",
  "minsum" : 2,
  "maxsum" : 15000,
  "parameters" : [ {
    "id" : 971,
    "code" : "phoneNumber",
    "minLength" : 10,
    "maxLength" : 10,
    "title" : "Номер телефона",
    "pattern" : null,
    "type" : null,
    "patternDescription" : "10-ти значный федеральный номер",
    "main" : true
  } ]
}
```
